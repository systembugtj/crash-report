<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" href="../favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CrashRpt: Architecture Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>

<table border="0" bgcolor="#FFFFFF" cellspacing="5">
 <tr>
  <td rowspan="2"><img src="../logo.png" alt="Logo" /></td>
  <td><font family="Arial" size="+2">crashrpt</font></td>
 </tr>
 <tr>
  <td><i>A crash reporting system for Windows applications</i></td>
 </tr>


</table>


</body>
<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Contents</span></a></li>
      <li><a href="modules.html"><span>API&nbsp;Reference</span></a></li>
      <li><a href="files.html"><span>File&nbsp;Reference</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">CrashRpt Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="introduction_to_crashrpt.html">Introduction to CrashRpt</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="architecture_overview">Architecture Overview </a></h1><h2><a class="anchor" name="crashrpt_mission">
CrashRpt Mission</a></h2>
<em> The mission</em> is to provide a set of tools for:<ul>
<li>handling exceptions (critical errors) in a client software</li><li>automatically collecting necessary error info and generating error reports</li><li>deliverying error reports over the internet</li><li>and simplifying error report postprocessing</li></ul>
<h2><a class="anchor" name="crashrpt_stackholders">
CrashRpt Stakeholders</a></h2>
<em>Stakeholders</em> are the individuals or groups that have their concerns in CrashRpt architecture:<ul>
<li>Developers that are interested in improving their software by analyzing user feedback on critical errors</li><li>Software end-users that are interested in better quality of programs they install and use</li><li>CrashRpt development team members that are interested in providing a set of convenient crash reporting tools that are widely used</li></ul>
<h2><a class="anchor" name="nonfunctional_requirements">
Non-functional Requirements</a></h2>
<b>Usability</b>. CrashRpt end-users should be provided with a user-friendly, clean and intuitive GUI. GUI should be localizable to end-user's favourite language.<p>
<b>Compatibility</b>. CrashRpt should support Windows operating system. 32-bit and 64-bit platforms should be supported. Visual C++ development environment should be supported.<p>
<b>Rubustness</b>. CrashRpt should provide crash reporting services not depending of client application state. Client application may be unstable, heap-corrupted, stack-corrupted and so on.<p>
<b>Testability</b>. The main features should be covered by automated tests to guarantee expected behavior.<h2><a class="anchor" name="crashrpt_structure">
CrashRpt Structure Overview</a></h2>
CrashRpt consists of two kinds of functionality: error reporting functionality and error report analyzis functionality. Error reporting functionality is distributed with a client software and responsible for handling exceptions in the client software and deliver error reports to the developer. Error report analyzis functionality is designed to help the developer to extract data contained in error reports and to simplify error report analyzis. It is usually located at the side of the developer and not distributed with the client software.<p>
<div align="center">
<img src="architecture.png" alt="architecture.png">
<p><strong>CrashRpt Architecture</strong></p></div>
 <h3><a class="anchor" name="error_reporting_functionality">
Error Reporting Functionality</a></h3>
Error reporting functionality consists of two core modules: <b>CrashRpt.dll</b> and <b>CrashSender.exe</b>.<ul>
<li><b>CrashRpt.dll</b> contains functionality for handling exceptions in the client software.</li><li><b>CrashSender.exe</b> contains functionality for sending error reports to the software's support team.</li></ul>
<p>
Two modules are needed to be able to close the application that crashes and to continue sending error report through <b>CrashSender.exe</b> in background.<p>
Typically a process (executable file) loads <b>CrashRpt.dll</b> into its address space when process starts. This single instance of CrashRpt is shared between all DLL modules that are loaded into the process' address space. Client application uses <a class="el" href="group___crash_rpt_a_p_i.html">CrashRpt Functions</a> to set exception handlers in the process once, typically in its <b>main()</b> function. In a multi-threaded program, client additionally sets exception handlers in the beginning of thread procedure of each worker thread. For additional info, see <a class="el" href="using_crashrpt_api.html">Using CrashRpt API</a>.<p>
CrashRpt is designed to use C runtime libraries (CRT) as a Multi-threaded DLL (/MD compiler flag). All modules in the client application must be linked to the same version of CRT DLL in order to use CrashRpt. If some dependent module of the application uses different version of CRT or is statically linked to CRT, exceptions are not intercepted in that module. For more information, see <a class="el" href="exception_handling.html">About Exceptions and Exception Handling</a>.<p>
In Visual C++, some exceptions related to security can't be intercepted. For example, since CRT v8.0 you can not handle security errors. When buffer overrun is detected, CRT invokes Dr. Watson directly instead of calling unhandled exception filter. This is done because of security reasons and Microsoft doesn't plan to change this behavior.<h3><a class="anchor" name="error_report_analyzis_functionality">
Error Report Analyzis Functionality</a></h3>
Error report analyzis functionality consists of two modules:<p>
<ul>
<li><b>CrashRptProbe.dll</b> implements API that can be used to access error report data.</li><li><b>crprober.exe</b> is a console tool that helps to extract error report data and write the summary in a human-readable form.</li></ul>
<p>
When you receive many error reports from users of your software, you would have to spend a lot of time to open each report, analyze its contents and write some summary about the report. There may be many reports related to the same problem, so opening such reports doesn't tell anything new. The error report analyzis functionality is designed to address these problems. For additional information, see <a class="el" href="analyzing_error_reports.html">Analyzing Error Reports</a>.<p>
<b>My software is not an EXE, but DLL. Can I use crashrpt in such case?</b><p>
Well, you can install exception handlers in your <b>DllMain()</b> function, but typically you can't guarantee that the client process (EXE) won't install its own exception handlers above yours. And there might be some problems if the client process uses several worker threads that call functions from your DLL. In such case you would have to install per-thread exception handlers too. It would be better if the client process take care of exception handling instead of your DLL.<p>
<b>How do I use crashrpt across process boundaries?</b><p>
Each process loads its own copy of <code>CrashRpt.dll</code>. It is difficult to imagine how you can share single loaded instance of CrashRpt.dll between several processes. Currently CrashRpt doesn't support such possibility.<p>
<b>Does using crashrpt affect performance of my application?</b><p>
No, using CrashRpt doesn't affect performance of your application. CrashRpt doesn't perform any tasks in background and doesn't use additional memory. CrashRpt code is executed just when an exception is raised.<p>
<b>Does using crashrpt make it easier for somebody to reverse engineer my code?</b><p>
No, actually not. In order to use CrashRpt, you enable program database generation in Release configuration (/Zi compiler flag and /DEBUG linker flag) and this generates .PDB file for your project. PDB files contain information which can be used to reverse engineer your code, however you typically store such information locally and do not distribute it with your software release package. So, using CrashRpt doesn't affect the difficulty of reverse engineering your code. </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Feb 15 19:41:00 2011 for CrashRpt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
